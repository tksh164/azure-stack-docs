---
title: Validation tests in AKS enabled by Azure Arc
description: Learn how to validate your environment and configuration prior to installing AKS enabled by Arc.
author: sethmanheim
ms.topic: troubleshooting
ms.date: 07/03/2024
ms.author: sethm 
ms.lastreviewed: 04/19/2023
ms.reviewer: waltero

---

# AKS enabled by Arc pre-installation validation tests

[!INCLUDE [aks-hybrid-applies-to-azure-stack-hci-windows-server-sku](includes/aks-hci-applies-to-skus/aks-hybrid-applies-to-azure-stack-hci-windows-server-sku.md)]

The following table lists the tests that are executed when you run the [Set-AksHciConfig](reference/ps/set-akshciconfig.md) and [Set-AksHciRegistration](reference/ps/set-akshciregistration.md) PowerShell cmdlets. The tests help to ensure that when you run the actual installation with [Install-AksHci](reference/ps/install-akshci.md), the installation process avoids many common environment and configuration issues. For a better understanding of the terms used in the tests, see the [AKS Arc concepts article](kubernetes-concepts.md).

| Test name                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Troubleshooting resources                                                                                                                                                                                                                       |
|---------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [MOC](concepts-node-networking.md) host internet connectivity                          | The test validates that the machine hosting MOC has internet connectivity to key Microsoft endpoints.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  - Ensure that there is connectivity from the physical hosts to the internet. <br /> - [Blog post on troubleshooting network issues in Windows Server](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-troubleshoot-windows-server-network-connectivity-issues/ba-p/1500934) <br />  - [Use HUD for troubleshooting network issues in Azure Stack HCI](https://techcommunity.microsoft.com/t5/networking-blog/introducing-network-hud-for-azure-stack-hci/ba-p/3676097) <br /> - [Firewall requirements for Azure Stack HCI](/azure-stack/hci/concepts/firewall-requirements) <br /> - [Troubleshooting Windows Server components](/windows-server/troubleshoot/windows-server-troubleshooting)      |
| MOC host limits                              | Validates that the machine hosting MOC has the minimum resources needed. See the published [hardware requirements](system-requirements.md?tabs=allow-table).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  Ensure that the minimum requirements are met: [AKS Arc system requirements](system-requirements.md?tabs=allow-table).                                                                                                                                                  |
| MOC host remoting                                       | Validates that PowerShell remoting is enabled and working from the MOC hosting machine to other physical hosts in the cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  - [Troubleshoot CredSSP issues](/azure-stack/hci/manage/troubleshoot-credssp) <br /> - [Troubleshoot PowerShell remoting issues](/powershell/module/microsoft.powershell.core/about/about_remote_troubleshooting)                                                                                                                                                                         |
| MOC network configuration                               | Validates that the MOC network configuration is correct. It verifies that: <br /> - The virtual switch exists. <br /> - The CloudServiceIP can be used to provide a static IP address to be assigned to the MOC CloudAgent service. This value should be provided using the standard IPv4 format; for example, **192.168.1.2**. The cloudServiceIP address should also be created from one of the ClusterAndClient networks in the underlying failover cluster. <br /> You can run the `Get-ClusterNetwork` command in an elevated PowerShell window to find the network role. You may want to specify this address to ensure that anything important on the network is always accessible, because the IP address doesn't change. <br /> - Should be able to create and start the failover cluster resource. <br /> - The cloud service IP should not overlap with the VIP pool, or k8snodepool IP addresses provided during VNET configuration.  |  - Ensure that the IP address of the **CloudServiceIP** meets the requirements in the description. <br /> - [AKS Arc network concepts](concepts-node-networking.md) <br /> - [AKS Arc network troubleshooting](known-issues-networking.yml) <br /> - [Can't bring a network name online in a failover cluster](/troubleshoot/windows-server/high-availability/troubleshoot-cannot-bring-network-name-online)                           |
| MOC SDN configuration                                   | Validates that the SDN configuration is correct, and the Network Controller is available. The test checks that: <br /> - Network Controller FQDN or IP address information is reachable. <br /> - Network Controller load balancer subnet resource reference is provided. <br /> - Network Controller L netRef is provided.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |  - If you're providing SDN parameters, ensure that SDN is available in the system. <br /> - [AKS Arc network concepts](concepts-node-networking.md) <br /> - [Troubleshooting SDN](/windows-server/networking/sdn/troubleshoot/troubleshoot-software-defined-networking) <br /> - [Checklist for troubleshooting SDN](/troubleshoot/windows-server/software-defined-networking/troubleshoot-sdn-guidance)                                                                 |
| MOC directories                                         | Validates MOC directories. The test checks for: <br /> - Valid directory names. <br /> - Config directory cannot contain the working directory. <br /> - Check if the working directory is in the cluster shared volume. <br /> - Check that the directories aren't local. <br /> - Check to ensure the working directory is not the system drive or root.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  - Ensure the user account has access to the directories provided. <br /> - Verify that no previous install of MOC exists. <br /> - Verify that the config directory cannot contain the working directory.                                                         |
| Failover cluster health                                 | Validates failover cluster health. It checks that the cluster nodes and cluster network are available.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  - Ensure that there is a failover setup, see [Failover clustering](/windows-server/failover-clustering/failover-clustering-overview). <br /> - [Run an HCI cluster validation test](/azure-stack/hci/manage/validate-qos). <br /> - [Troubleshooting the failover cluster](/windows-server/failover-clustering/troubleshooting-using-wer-reports)                                                                                                 |
| Failover cluster HCI registration                       | Validates failover cluster HCI registration. The test checks for the presence of a failover cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | - [Run an HCI cluster validation test](/azure-stack/hci/manage/validate-qos). <br /> - [Troubleshooting the failover cluster](/windows-server/failover-clustering/troubleshooting-using-wer-reports)                                                                                                                                                                     |
| AKS management cluster configuration                    | Validates the AKS management cluster configuration and corresponding host machine configuration to make sure the host is ready to install it successfully. Verifies: <br /> - AKS management image is present. <br /> - AKS Arc-related binaries are present in all nodes. <br /> - Necessary Azure Stack HCI cloud roles are added. <br /> - Verifies Azure Stack HCI cloud location. <br /> - Verifies Azure Stack HCI cloud storage container. <br /> - Verifies permissions to create an Azure resource. <br /> - Verifies Azure Stack HCI network and load balancer type. <br /> - Verifies Kube-Vip configuration. <br /> - Verifies Vip-pool IPs. <br /> - Verifies K8s node pool IPs.                                                                                                                                                                                                                                                                                       |  - Review the [Active Directory requirements](system-requirements.md?tabs=allow-table). <br /> - [AKS Arc network troubleshooting](concepts-node-networking.md) <br /> - Ensure the user has the necessary permissions. <br /> - Ensure that IP formatting is correct.                                                                                 |
| AKS management cluster configuration proxy connectivity | Validates that the configuration allows internet connectivity to Microsoft endpoints with or without a proxy server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |   - Ensure the host has internet connectivity. <br /> - Follow the [proxy settings guide](set-proxy-settings.md).                                                                                                                                                                   |
| AKS Arc internet connectivity | Validates that the virtual machine hosting AKS Arc has internet connectivity to key [Microsoft endpoints](system-requirements.md?tabs=allow-table#network-port-and-url-requirements). | - Ensure that there's connectivity from the physical hosts to the internet. <br /> - If you're using a proxy, ensure that the proxy settings passed in [Set-AksHciConfig](reference/ps/set-akshciconfig.md) are correct.<br /> - Ensure there is connectivity from any VMs in the nodepool IP range provided in the [New-AksHciNetworkSetting](reference/ps/new-akshcinetworksetting.md) cmdlet parameters `-k8sNodeIpPoolStart` and `-k8sNodeIpPoolStart`.<br /> - [Blog post on troubleshooting network issues in Windows Server](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-troubleshoot-windows-server-network-connectivity-issues/ba-p/1500934) <br />  - [Use HUD for troubleshooting network issues in Azure Stack HCI](https://techcommunity.microsoft.com/t5/networking-blog/introducing-network-hud-for-azure-stack-hci/ba-p/3676097) <br /> - [Firewall requirements for Azure Stack HCI](/azure-stack/hci/concepts/firewall-requirements) <br /> - [Troubleshooting Windows Server components](/windows-server/troubleshoot/windows-server-troubleshooting) |
| DNS availability | Validates that the provided DNS servers are available. | Ensure that the DNS servers provided in the [New-AksHciNetworkSetting](reference/ps/new-akshcinetworksetting.md) cmdlet parameter `-dnsServers` are available to VMs in the IP range provided in the parameters `-k8sNodeIpPoolStart` and `-k8sNodeIpPoolStart`. |
| Connectivity between the VM that hosts the AKS Arc ([management cluster](kubernetes-concepts.md#the-management-cluster)) and the cloud agent. | Validates that VMs in the **K8sNoodPool** range can reach the cloud agent endpoint. | - Ensure that the DNS servers provided in [New-AksHciNetworkSetting](reference/ps/new-akshcinetworksetting.md) can resolve the cloud agent FQDN. <br /> - Ensure that the cloud agent endpoint is online. |

## Next steps

- [AKS Arc overview](overview.md)
- [Supported Kubernetes versions](supported-kubernetes-versions.md)
